- title 'Dashboard'[]

- cache(cache_key) do
  - if @rankings.size > 0
    = render :partial => 'leaderboard', :locals => { :people => @rankings, :start_at => 1, :title => 'Rankings'[], :details => '' }

  - if @newbies.size > 0
    = render :partial => 'leaderboard', :locals => { :people => @newbies, :start_at => @rankings.size + 1, :title => 'Newbies'[], :details => "- less than {limit} games"[:less_than_games, current_account.newbie_limit] }

#recent_games.column.span-12
  = render :partial => 'recent_games', :locals => { :recent_games => @recent_games }
      
- cache(cache_key('games_per_day')) do
  #games_per_day.column.span-6.last
    = render :partial => 'games_per_day', :locals => { :games_per_day => @games_per_day }

- content_for :sidebar do
  - cache(cache_key('sidebar')) do
    - unless @leader.nil?
      #leader
        %h3= 'Leader'[]
        .mugshot= link_to image_tag(@leader.mugshot.public_filename(:thumb), :alt => @leader.name), user_path(@leader) if @leader.mugshot
        = user_link_full @leader

    #counts
      %h3= 'Totals'[]
    
      %table
        %tr
          %td
            %label= 'Games played'[] + ':'
            = @game_count
          %td
            %label= 'Goals scored'[] + ':'
            = @goals_scored
        - unless @all_time_high.nil? && @all_time_low.nil?
          %tr
            %td
              - unless @all_time_high.nil?
                %label= 'All time high'[] + ':'
                = link_to @all_time_high.current_ranking, game_path(@all_time_high.team.game), :class => 'game'
                = 'by'[]
                %br
                = user_link_full find_user(@all_time_high.user_id)
            %td
              - unless @all_time_low.nil?
                %label= 'All time low'[] + ':'
                = link_to @all_time_low.current_ranking, game_path(@all_time_low.team.game), :class => 'game'
                = 'by'[]
                %br
                = user_link_full find_user(@all_time_low.user_id)

  - if @comments && @comments.size > 0
    #recent_comments
      %h3= 'Recent comments'[]
     
      - @comments.each do |comment|
        .comment
          .user= find_user(comment.user_id).name
          .body= link_to h(truncate(comment.body.strip, 40)), game_path(comment.game_id, :anchor => "c#{comment.id}")