- title 'Dashboard'[]

- cache(dashboard_path) do
  %h3= 'Rankings'[]

  %table.list
    %tr
      %th= '&nbsp;'
      %th= 'Person'[]
      %th= 'Ranking'[]
      %th= 'Played'[]
      %th= 'Won'[]
      %th= 'Lost'[]
      %th= 'Win %'[]
      %th{ :title => 'Goals for'[] }= 'GF'[]
      %th{ :title => 'Goals against'[] }= 'GA'[]
      %th{ :title => 'Goals for - goals against'[] }= '+/-'
      %th= '+/- ' + 'Average'[]

    - @people.each_with_index do |person, index|
      %tr{ :class => cycle('odd', 'even') }
        %td= index + 1
        %td
          = link_to image_tag('icons/sport_soccer.png', :class => 'team', :alt => "Show this person's games"[]), games_path(:filter => person.id)
          = person.full_name
        %td= person.ranking
        %td= person.memberships_count
        %td= person.games_won
        %td= person.memberships_count - person.games_won
        %td= person.winning_percentage.to_s + '%'
        %td= person.goals_for
        %td= person.goals_against
        %td= person.difference
        %td= person.difference_average
    - reset_cycle

  .columns
    .left-column
      #recent_games
        %h3= 'Recent games'[]
        = render :partial => 'recent_games', :locals => { :recent_games => @recent_games }

    .right-column
      #games_per_day
        %h3= 'Games played per day'[]
        = render :partial => 'games_per_day', :locals => { :games_per_day => @games_per_day }

- content_for :sidebar do
  - cache(dashboard_path + '_sidebar') do
    #leader
      %h3= 'Leader'[]
      .mugshot= image_tag @leader.mugshot.public_filename(:thumb), :alt => @leader.full_name if @leader.mugshot
      = @leader.full_name

    #counts
      %p
        %label= 'Games played'[] + ':'
        = @game_count
      %p
        %label= 'Goals scored'[] + ':'
        = @goals_scored

  - if logged_in?
    - cache(dashboard_path + '_new_game') do
      = render :partial => 'games/form'
  - else
    = 'Login to add a game.'[]

